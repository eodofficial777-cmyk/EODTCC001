
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the EOD 終端機 application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "roleName": {
          "type": "string",
          "description": "The unique role name chosen by the user."
        },
        "plurkInfo": {
          "type": "string",
          "description": "User's Plurk information (e.g., username, profile URL)."
        },
        "characterSheetUrl": {
          "type": "string",
          "description": "URL to the character sheet image."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL to the user's avatar image."
        },
        "factionId": {
          "type": "string",
          "description": "The ID of the faction the user belongs to."
        },
        "raceId": {
          "type": "string",
          "description": "The ID of the race of the user's character."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time the user registered.",
          "format": "date-time"
        },
        "approved": {
          "type": "boolean",
          "description": "Indicates whether the user's account has been approved by an administrator."
        },
        "honorPoints": {
          "type": "number",
          "description": "The character's honor points."
        },
        "currency": {
          "type": "number",
          "description": "The character's currency."
        },
        "totalCurrencyEarned": {
            "type": "number",
            "description": "The total cumulative currency earned by the character, not affected by spending."
        },
        "titles": {
          "type": "array",
          "description": "An array of titles the character has earned.",
          "items": {
            "type": "string"
          }
        },
        "equipment": {
          "type": "array",
          "description": "An array of equipment IDs the character has equipped.",
          "items": {
            "type": "string"
          }
        },
        "items": {
          "type": "array",
          "description": "An array containing all item IDs the character possesses. This array allows for duplicate entries to represent stackable items.",
          "items": {
            "type": "string"
          }
        },
        "tasks": {
          "type": "array",
          "description": "An array of task IDs the character has submitted.",
          "items": {
            "type": "string"
          }
        },
        "submittedMainQuest": {
          "type": "boolean",
          "description": "Flag indicating if the user has submitted the main quest task."
        },
        "attributes": {
          "type": "object",
          "description": "The character's attributes.",
          "properties": {
            "hp": { "type": "number" },
            "atk": { "type": "number" },
            "def": { "type": "number" }
          }
        },
        "participatedBattleIds": {
            "type": "array",
            "description": "An array of combat encounter IDs the user has participated in.",
            "items": { "type": "string" }
        },
        "hpZeroCount": {
            "type": "number",
            "description": "Number of times the user's HP dropped to zero in battles."
        },
        "itemUseCount": {
            "type": "object",
            "description": "A map of item IDs to the number of times the user has used them.",
            "additionalProperties": { "type": "number" }
        }
      },
      "required": [
        "id",
        "roleName",
        "plurkInfo",
        "registrationDate",
        "approved",
        "honorPoints",
        "currency",
        "factionId",
        "raceId",
        "attributes"
      ]
    },
    "Character": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Character",
      "type": "object",
      "description": "Represents a character within the EOD 終端機 application, associated with a user.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the character." },
        "userId": { "type": "string", "description": "Reference to the User who owns this character." },
        "name": { "type": "string", "description": "The character's name." },
        "factionId": { "type": "string", "description": "Reference to the Faction the character belongs to." },
        "raceId": { "type": "string", "description": "Reference to the Race of the character." },
        "honorPoints": { "type": "number", "description": "The character's honor points." },
        "attributes": { "type": "string", "description": "The character's attributes." },
        "resources": { "type": "string", "description": "The character's resources." },
        "equipmentIds": {
          "type": "array",
          "description": "References to the Equipment the character has.",
          "items": { "type": "string" }
        }
      },
      "required": [ "id", "userId", "name", "factionId", "raceId", "honorPoints" ]
    },
    "Faction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Faction",
      "type": "object",
      "description": "Represents a faction within the EOD 終端機 application.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the faction." },
        "name": { "type": "string", "description": "The name of the faction." },
        "score": { "type": "number", "description": "The current score of the faction." }
      },
      "required": [ "id", "name", "score" ]
    },
    "Race": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Race",
      "type": "object",
      "description": "Represents a race within the EOD 終端機 application.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the race." },
        "name": { "type": "string", "description": "The name of the race." },
        "description": { "type": "string", "description": "A description of the race." },
        "hp": { "type": "number", "description": "Base hit points for the race." },
        "atk": { "type": "number", "description": "Base attack power for the race." },
        "def": { "type": "number", "description": "Base defense power for the race." }
      },
      "required": [ "id", "name", "description", "hp", "atk", "def" ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task submitted by a user.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the task." },
        "userId": { "type": "string", "description": "Reference to the User who submitted the task." },
        "userName": { "type": "string", "description": "The name of the user who submitted the task." },
        "userFactionId": { "type": "string", "description": "The faction of the user who submitted the task." },
        "taskTypeId": { "type": "string", "description": "Reference to the TaskType of the task." },
        "title": { "type": "string", "description": "The title or description of the submission." },
        "submissionUrl": { "type": "string", "description": "URL where the task submission can be found.", "format": "uri" },
        "honorPointsAwarded": { "type": "number", "description": "Honor points awarded for the task." },
        "currencyAwarded": { "type": "number", "description": "Currency awarded for the task." },
        "submissionDate": { "type": "string", "description": "Date and time the task was submitted.", "format": "date-time" },
        "status": { "type": "string", "description": "The review status of the task.", "enum": [ "pending", "approved", "rejected" ] },
        "factionContribution": { "type": "string", "description": "For Wanderers, which faction this task contributed to." }
      },
      "required": [ "id", "userId", "userName", "userFactionId", "taskTypeId", "title", "submissionUrl", "honorPointsAwarded", "currencyAwarded", "submissionDate", "status" ]
    },
    "TaskType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TaskType",
      "type": "object",
      "description": "Represents a type of task that can be submitted.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the task type." },
        "name": { "type": "string", "description": "The name of the task type." },
        "description": { "type": "string", "description": "A description of the task type." },
        "honorPoints": { "type": "number", "description": "Honor points awarded for this task type." },
        "currency": { "type": "number", "description": "Currency awarded for this task type." },
        "titleAwarded": { "type": "string", "description": "The title ID awarded for completing this task type (optional)." },
        "itemAwarded": { "type": "string", "description": "The item ID awarded for completing this task type (optional)." },
        "category": { "type": "string", "description": "The category of the task.", "enum": ["main", "side", "general"] },
        "requiresApproval": { "type": "boolean", "description": "Indicates if a task of this type requires admin approval before rewards are given." },
        "singleSubmission": { "type": "boolean", "description": "Indicates if a user can only submit a task of this type once." }
      },
      "required": [ "id", "name", "description", "honorPoints", "currency", "category", "requiresApproval", "singleSubmission" ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item in the game.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the item." },
        "name": { "type": "string", "description": "The name of the item." },
        "description": { "type": "string", "description": "A description of the item." },
        "imageUrl": { "type": "string", "format": "uri", "description": "URL of the item's image." },
        "itemTypeId": { "type": "string", "description": "Reference to the ItemType of the item.", "enum": ["equipment", "consumable", "special", "stat_boost"] },
        "price": { "type": "number", "description": "The price of the item." },
        "factionId": { "type": "string", "description": "Reference to the Faction that this item belongs to." },
        "raceId": { "type": "string", "description": "Race restriction for the item. Can be 'all' for no restriction." },
        "isUsable": { "type": "boolean", "description": "If true, this special item can be 'used' from the inventory." },
        "effects": {
            "type": "array",
            "description": "Structured description of the item's effects.",
            "items": { "oneOf": [
                {
                    "type": "object",
                    "properties": { "attribute": { "type": "string", "enum": ["hp", "atk", "def"] }, "operator": { "type": "string", "enum": ["+", "*", "d"] }, "value": { "type": ["number", "string"] } },
                    "required": ["attribute", "operator", "value"]
                },
                {
                    "type": "object",
                    "properties": { "trigger": { "type": "string", "enum": ["on_use"] }, "probability": { "type": "number", "minimum": 0, "maximum": 100 }, "effectType": { "type": "string", "enum": ["hp_recovery", "damage_enemy", "atk_buff", "def_buff", "hp_cost"] }, "value": { "type": "number" }, "duration": { "type": "number" } },
                    "required": ["trigger", "probability", "effectType", "value"]
                }
            ]}
        },
        "isPublished": { "type": "boolean", "description": "If true, the item will appear in the faction store." }
      },
      "required": [ "id", "name", "description", "itemTypeId", "price", "factionId", "raceId", "isPublished", "effects" ]
    },
    "ItemType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ItemType",
      "type": "object",
      "description": "Represents a type of item.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the item type." },
        "name": { "type": "string", "description": "The name of the item type." },
        "description": { "type": "string", "description": "A description of the item type." }
      },
      "required": [ "id", "name", "description" ]
    },
    "Equipment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Equipment",
      "type": "object",
      "description": "Represents a piece of equipment a character can equip.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the equipment." },
        "name": { "type": "string", "description": "The name of the equipment." },
        "description": { "type": "string", "description": "A description of the equipment." },
        "attributes": { "type": "string", "description": "The attributes that the equipment provides to the character." }
      },
      "required": [ "id", "name", "description", "attributes" ]
    },
    "CombatLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CombatLog",
      "type": "object",
      "description": "Represents log data for a combat encounter.",
      "properties": {
        "id": { "type": "string" },
        "encounterId": { "type": "string" },
        "logData": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "turn": { "type": "number" },
        "type": { "type": "string", "enum": ["player_attack", "monster_attack", "skill_used", "item_used", "system"] },
        "itemId": { "type": "string", "description": "The ID of the item used, for item_used logs." },
        "damage": { "type": "number", "description": "The amount of damage dealt in this action." }
      },
      "required": [ "id", "encounterId", "logData", "timestamp", "turn", "type" ]
    },
     "Participant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Participant",
      "type": "object",
      "description": "Represents a player's state within a specific combat encounter.",
      "properties": {
        "hp": { "type": "number" },
        "roleName": { "type": "string" },
        "factionId": { "type": "string" },
        "equippedItems": { "type": "array", "items": { "type": "string" } },
        "supportedFaction": { "type": "string", "enum": ["yelu", "association"] },
        "activeBuffs": { "type": "array", "description": "List of active buffs on the participant.", "items": { "$ref": "#/entities/ActiveBuff" } },
        "skillCooldowns": { "type": "object", "description": "A map of skill IDs to the number of turns remaining for cooldown.", "additionalProperties": { "type": "number" } }
      },
      "required": ["hp", "roleName", "factionId"]
    },
     "ActiveBuff": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "ActiveBuff",
        "type": "object",
        "description": "Represents a temporary buff or debuff on a participant.",
        "properties": {
          "effectType": { "type": "string" },
          "value": { "type": ["number", "string"] },
          "duration": { "type": "number" },
          "turnsLeft": { "type": "number" }
        },
        "required": ["effectType", "turnsLeft"]
    },
    "EndOfBattleRewards": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EndOfBattleRewards",
      "type": "object",
      "description": "Defines rewards to be distributed at the end of a battle.",
      "properties": {
        "honorPoints": { "type": "number" },
        "currency": { "type": "number" },
        "itemId": { "type": "string" },
        "titleId": { "type": "string" },
        "logMessage": { "type": "string" }
      }
    },
    "CombatEncounter": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CombatEncounter",
      "type": "object",
      "description": "Represents an instance of a combat encounter.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "status": { "type": "string", "enum": ["preparing", "active", "ended", "closed"] },
        "startTime": { "type": "string", "format": "date-time" },
        "preparationEndTime": { "type": "string", "format": "date-time" },
        "endTime": { "type": "string", "format": "date-time" },
        "monsters": { "type": "array", "items": { "$ref": "#/entities/Monster" } },
        "turn": { "type": "number" },
        "participants": { "type": "object", "additionalProperties": { "$ref": "#/entities/Participant" } },
        "endOfBattleRewards": { "$ref": "#/entities/EndOfBattleRewards" }
      },
      "required": ["id", "name", "status", "startTime", "preparationEndTime", "monsters", "turn"]
    },
    "Monster": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Monster",
      "type": "object",
      "description": "Represents a monster in a combat encounter.",
      "properties": {
        "monsterId": { "type": "string" },
        "name": { "type": "string" },
        "factionId": { "type": "string", "enum": ["yelu", "association", "common"] },
        "imageUrl": { "type": "string", "format": "uri" },
        "hp": { "type": "number" },
        "originalHp": { "type": "number" },
        "atk": { "type": "string" }
      },
      "required": ["monsterId", "name", "factionId", "hp", "originalHp", "atk"]
    },
    "Title": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Title",
      "type": "object",
      "description": "Represents a title or achievement a user can earn.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the title." },
        "name": { "type": "string", "description": "The name of the title." },
        "description": { "type": "string", "description": "A description of how to earn the title." },
        "isHidden": { "type": "boolean", "description": "Indicates whether the title is hidden until earned." },
        "isManual": { "type": "boolean", "description": "True if the title is awarded manually by an admin." },
        "trigger": {
          "type": "object",
          "description": "The condition that automatically awards this title.",
          "properties": {
            "type": { "type": "string", "enum": ["honor_points", "currency", "tasks_submitted", "battles_participated", "battles_hp_zero", "item_used", "item_damage", "top_faction_damage"] },
            "value": { "type": "number", "description": "The target value for the trigger type (e.g., 1000 for 1000 honor points)." },
            "itemId": { "type": "string", "description": "The ID of the item for item-related triggers." },
            "damageThreshold": { "type": "number", "description": "The damage threshold for item_damage triggers." }
          },
          "required": ["type", "value"]
        }
      },
      "required": ["id", "name", "description", "isHidden", "isManual"]
    },
    "CharacterTitle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CharacterTitle",
      "type": "object",
      "description": "Links characters to their earned titles.",
      "properties": {
        "characterId": { "type": "string" },
        "titleId": { "type": "string" },
        "obtainedDate": { "type": "string", "format": "date-time" }
      },
      "required": [ "characterId", "titleId", "obtainedDate" ]
    },
    "Skill": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Skill",
      "type": "object",
      "description": "Represents a skill a character can use.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the skill." },
        "name": { "type": "string", "description": "The name of the skill." },
        "description": { "type": "string", "description": "A description of the skill's effects." },
        "factionId": { "type": "string" },
        "raceId": { "type": "string" },
        "cooldown": { "type": "number", "description": "The number of turns before the skill can be used again." },
        "effects": {
            "type": "array", "description": "Structured description of the skill's effects.",
            "items": { "type": "object", "properties": {
                    "effectType": { "type": "string", "enum": ["hp_recovery", "direct_damage", "atk_buff", "def_buff", "hp_cost", "probabilistic_damage"] },
                    "value": { "type": ["number", "string"] },
                    "probability": { "type": "number", "minimum": 0, "maximum": 100 },
                    "duration": { "type": "number" }
                }, "required": ["effectType"]
            }
        }
      },
      "required": [ "id", "name", "description", "cooldown", "effects" ]
    },
    "ActivityLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActivityLog",
      "type": "object",
      "description": "Represents a log entry for a character's activity.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "description": { "type": "string" },
        "change": { "type": "string" }
      },
      "required": [ "id", "userId", "timestamp", "description", "change" ]
    },
    "CraftRecipe": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "CraftRecipe",
        "type": "object",
        "description": "Defines a crafting recipe for combining items.",
        "properties": {
            "id": { "type": "string" },
            "baseItemId": { "type": "string" },
            "materialItemId": { "type": "string" },
            "resultItemId": { "type": "string" },
             "isPublished": { "type": "boolean" }
        },
        "required": [ "id", "baseItemId", "materialItemId", "resultItemId", "isPublished" ]
    },
    "Maintenance": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Maintenance",
        "type": "object",
        "description": "Global maintenance status of the application.",
        "properties": { "isMaintenance": { "type": "boolean" } },
        "required": ["isMaintenance"]
    },
    "RegistrationStatus": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "RegistrationStatus",
        "type": "object",
        "description": "Global registration status of the application.",
        "properties": { "isOpen": { "type": "boolean" } },
        "required": ["isOpen"]
    }
  },
  "auth": {
    "providers": [ "password", "anonymous" ]
  },
  "firestore": {
    "structure": [
      { "path": "/users/{userId}", "definition": { "schema": { "$ref": "#/entities/User" } } },
      { "path": "/factions/{factionId}", "definition": { "schema": { "$ref": "#/entities/Faction" } } },
      { "path": "/races/{raceId}", "definition": { "schema": { "$ref": "#/entities/Race" } } },
      { "path": "/tasks/{taskId}", "definition": { "schema": { "$ref": "#/entities/Task" } } },
      { "path": "/users/{userId}/activityLogs/{logId}", "definition": { "schema": { "$ref": "#/entities/ActivityLog" } } },
      { "path": "/taskTypes/{taskTypeId}", "definition": { "schema": { "$ref": "#/entities/TaskType" } } },
      { "path": "/items/{itemId}", "definition": { "schema": { "$ref": "#/entities/Item" } } },
      { "path": "/itemTypes/{itemTypeId}", "definition": { "schema": { "$ref": "#/entities/ItemType" } } },
      { "path": "/craftRecipes/{recipeId}", "definition": { "schema": { "$ref": "#/entities/CraftRecipe" } } },
      { "path": "/combatEncounters/{combatEncounterId}", "definition": { "schema": { "$ref": "#/entities/CombatEncounter" } } },
      { "path": "/combatEncounters/{combatEncounterId}/combatLogs/{combatLogId}", "definition": { "schema": { "$ref": "#/entities/CombatLog" } } },
      { "path": "/titles/{titleId}", "definition": { "schema": { "$ref": "#/entities/Title" } } },
      { "path": "/skills/{skillId}", "definition": { "schema": { "$ref": "#/entities/Skill" } } },
      { "path": "/globals/maintenance", "definition": { "schema": { "$ref": "#/entities/Maintenance" } } },
      { "path": "/globals/registration", "definition": { "schema": { "$ref": "#/entities/RegistrationStatus" } } }
    ]
  }
}
